<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rental Property ROI Calculator | FCalculator.com</title>
    <link rel="stylesheet" href="https://fcalculator.com/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.20/jspdf.plugin.autotable.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "Rental Property ROI Calculator",
        "description": "Calculate returns on rental property investments with detailed cash flow projections, ROI, cap rate, IRR, and amortization schedules, including repair costs and appreciation.",
        "url": "https://fcalculator.com/rental-property-roi-simulator.html",
        "breadcrumb": {
            "@type": "BreadcrumbList",
            "itemListElement": [
                {
                    "@type": "ListItem",
                    "position": 1,
                    "name": "Home",
                    "item": "https://fcalculator.com/"
                },
                {
                    "@type": "ListItem",
                    "position": 2,
                    "name": "Financial",
                    "item": "https://fcalculator.com/financial.html"
                },
                {
                    "@type": "ListItem",
                    "position": 3,
                    "name": "Rental Property ROI Calculator",
                    "item": "https://fcalculator.com/rental-property-roi-simulator.html"
                }
            ]
        }
    }
    </script>
    <style>
        #rental-form {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .currency-section {
            width: 100%;
            max-width: 400px;
            margin-bottom: 20px;
            text-align: center;
        }
        .sections-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            width: 100%;
        }
        fieldset {
            flex: 1 1 300px;
            margin: 10px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .input-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .input-row label {
            flex: 1;
            margin-right: 10px;
            text-align: right;
        }
        .input-row input, .input-row select {
            flex: 1;
        }
        @media (max-width: 768px) {
            .sections-container {
                flex-direction: column;
            }
            .input-row {
                flex-direction: column;
            }
            .input-row label {
                text-align: left;
                margin-right: 0;
                margin-bottom: 5px;
            }
        }
        #pdf-button, .share-button {
            margin: 10px;
        }
        .results-section {
            text-align: center;
            font-size: 1.3em;
            color: green;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px auto;
            max-width: 600px;
            background-color: #f9f9f9;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .results-section p {
            margin: 10px 0;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .results-section p:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">FCalculator.com</div>
        <div class="breadcrumb">
            <a href="/">FCalculator.com</a> > <a href="/financial.html">Financial</a> > <a href="/rental-property-roi-simulator.html">Rental Property ROI Calculator</a>
        </div>
        <h1>Rental Property ROI Calculator</h1>
        <p>Analyze potential returns from rental properties with detailed projections for cash flow, ROI, cap rate, IRR, and property value appreciation.</p>
    </header>

    <main>
        <section class="tool-section">
            <form id="rental-form">
                <div class="currency-section">
                    <label for="currency">Currency:</label>
                    <select id="currency">
                        <option value="$" selected>$</option>
                        <option value="€">€</option>
                    </select>
                </div>

                <div class="sections-container">
                    <fieldset>
                        <legend>Purchase</legend>
                        <div class="input-row">
                            <label for="property-price">Purchase Price</label>
                            <input type="number" id="property-price" value="250000" required>
                        </div>
                        <div class="input-row">
                            <label for="closing-cost">Closing Cost</label>
                            <input type="number" id="closing-cost" value="5000" required>
                        </div>
                        <div class="input-row">
                            <label for="use-loan">Use Loan?</label>
                            <select id="use-loan">
                                <option value="yes" selected>Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        <div class="input-row">
                            <label for="down-payment">Down Payment (%)</label>
                            <input type="number" id="down-payment" min="0" max="100" value="20" required>
                        </div>
                        <div class="input-row">
                            <label for="interest-rate">Annual Interest Rate (%)</label>
                            <input type="number" id="interest-rate" step="0.01" value="4.5" required>
                        </div>
                        <div class="input-row">
                            <label for="loan-term">Loan Term (Years)</label>
                            <input type="number" id="loan-term" value="30" required>
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend>Repairs</legend>
                        <div class="input-row">
                            <label for="need-repairs">Need Repairs?</label>
                            <select id="need-repairs">
                                <option value="no" selected>No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>
                        <div class="input-row">
                            <label for="repair-cost">Repair Cost</label>
                            <input type="number" id="repair-cost" value="10000" required>
                        </div>
                        <div class="input-row">
                            <label for="after-repair-value">Value After Repairs</label>
                            <input type="number" id="after-repair-value" value="270000" required>
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend>Recurring Operating Expenses</legend>
                        <div class="input-row">
                            <label for="annual-taxes">Annual Property Taxes</label>
                            <input type="number" id="annual-taxes" value="3000" required>
                        </div>
                        <div class="input-row">
                            <label for="taxes-increase">Annual Increase (%)</label>
                            <input type="number" id="taxes-increase" value="3" step="0.1" required>
                        </div>
                        <div class="input-row">
                            <label for="annual-insurance">Annual Insurance</label>
                            <input type="number" id="annual-insurance" value="1200" required>
                        </div>
                        <div class="input-row">
                            <label for="insurance-increase">Annual Increase (%)</label>
                            <input type="number" id="insurance-increase" value="3" step="0.1" required>
                        </div>
                        <div class="input-row">
                            <label for="hoa-fee">HOA Fee (Monthly)</label>
                            <input type="number" id="hoa-fee" value="100" required>
                        </div>
                        <div class="input-row">
                            <label for="hoa-increase">Annual Increase (%)</label>
                            <input type="number" id="hoa-increase" value="3" step="0.1" required>
                        </div>
                        <div class="input-row">
                            <label for="monthly-maintenance">Monthly Maintenance (% of Rent)</label>
                            <input type="number" id="monthly-maintenance" min="0" max="100" value="10" required>
                        </div>
                        <div class="input-row">
                            <label for="maintenance-increase">Annual Increase (%)</label>
                            <input type="number" id="maintenance-increase" value="3" step="0.1" required>
                        </div>
                        <div class="input-row">
                            <label for="other-costs">Other Monthly Costs</label>
                            <input type="number" id="other-costs" value="50" required>
                        </div>
                        <div class="input-row">
                            <label for="other-costs-increase">Annual Increase (%)</label>
                            <input type="number" id="other-costs-increase" value="3" step="0.1" required>
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend>Income</legend>
                        <div class="input-row">
                            <label for="monthly-rent">Monthly Rent</label>
                            <input type="number" id="monthly-rent" value="1500" required>
                        </div>
                        <div class="input-row">
                            <label for="rent-increase">Annual Increase (%)</label>
                            <input type="number" id="rent-increase" value="3" step="0.1" required>
                        </div>
                        <div class="input-row">
                            <label for="other-income">Other Monthly Income</label>
                            <input type="number" id="other-income" value="0" required>
                        </div>
                        <div class="input-row">
                            <label for="other-income-increase">Annual Increase (%)</label>
                            <input type="number" id="other-income-increase" value="3" step="0.1" required>
                        </div>
                        <div class="input-row">
                            <label for="vacancy-rate">Vacancy Rate (%)</label>
                            <input type="number" id="vacancy-rate" min="0" max="100" value="5" required>
                        </div>
                        <div class="input-row">
                            <label for="management-fee">Management Fee (% of Rent)</label>
                            <input type="number" id="management-fee" min="0" max="100" value="8" required>
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend>Sell</legend>
                        <div class="input-row">
                            <label for="know-sell-price">Do You Know the Sell Price?</label>
                            <select id="know-sell-price">
                                <option value="no" selected>No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>
                        <div class="input-row">
                            <label for="appreciation">Value Appreciation (% per Year)</label>
                            <input type="number" id="appreciation" step="0.1" value="3" required>
                        </div>
                        <div class="input-row">
                            <label for="sell-price">Sell Price</label>
                            <input type="number" id="sell-price" value="400000" required>
                        </div>
                        <div class="input-row">
                            <label for="holding-length">Holding Length (Years)</label>
                            <input type="number" id="holding-length" value="20" required>
                        </div>
                        <div class="input-row">
                            <label for="sell-cost">Cost to Sell (%)</label>
                            <input type="number" id="sell-cost" min="0" max="100" value="8" required>
                        </div>
                    </fieldset>
                </div>

                <button type="button" onclick="calculateRental()">Calculate</button>
            </form>

            <div id="results" class="results-section" style="display: none;">
                <p id="monthly-mortgage">Monthly Mortgage: $957.87</p>
                <p id="monthly-cash-flow">Monthly Cash Flow: $117.63</p>
                <p id="cap-rate">Cap Rate: 4.18%</p>
                <p id="annual-roi">Annual ROI: 2.82%</p>
                <p id="irr">Internal Rate of Return (IRR): 8.12%</p>
                <p id="total-return">Total Return Over Term: $250258.80</p>
            </div>

            <canvas id="expenseChart" width="400" height="200"></canvas>
            <canvas id="cashFlowChart" width="400" height="200"></canvas>
            <canvas id="valueChart" width="400" height="200"></canvas>
            <canvas id="noiChart" width="400" height="200"></canvas>
            <canvas id="roiComponentsChart" width="400" height="200"></canvas>

            <table id="amortization-table" style="margin: 20px auto;">
                <thead>
                    <tr>
                        <th>Year</th>
                        <th>Principal Paid</th>
                        <th>Interest Paid</th>
                        <th>Balance</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>

            <button onclick="saveAsPDF()" id="pdf-button">Save as PDF</button>
            <button onclick="sharePage()" class="share-button">Share this page</button>
        </section>

        <section class="content-section">
            <h2>Understanding Rental Property Investments</h2>
            <p>Rental property investments represent a strategic approach to building wealth through real estate, combining immediate cash flow from tenants with long-term asset appreciation. Investors often evaluate factors such as location, property condition, and market trends to maximize returns. This calculator assists in modeling scenarios by incorporating variables like initial purchase costs, ongoing expenses, and projected income streams, enabling informed decision-making for both novice and experienced real estate enthusiasts. Understanding these elements is crucial for assessing the potential profitability and risks associated with rental properties, from urban apartments to suburban homes. With rising demand for housing in growing economies, rental investments can provide steady income while hedging against inflation.</p>
            <p>To compute the monthly mortgage payment, the tool employs the standard amortization formula:</p>
            \[ M = P \frac{r(1+r)^n}{(1+r)^n - 1} \]
            <p>Here, \( M \) denotes the monthly payment, \( P \) is the principal loan amount, \( r \) stands for the monthly interest rate, and \( n \) represents the total number of payments over the loan term. This formula ensures accurate projections of financing costs, which are crucial for assessing overall investment viability. By adjusting parameters like interest rates and loan terms, users can explore how different financing options impact cash flow and return metrics, helping to optimize borrowing strategies in volatile interest rate environments.</p>

            <h3>Key Metrics Explained</h3>
            <ul>
                <li><strong>Cash Flow</strong>: Represents the net income generated from rental payments after deducting all operational expenses, including mortgage payments, property taxes, insurance, HOA fees, maintenance, management costs, and vacancy allowances. Positive cash flow is essential for covering costs and providing ongoing returns, while negative flow may indicate the need for adjustments in rental pricing or expense management. Monitoring cash flow helps investors maintain financial health and reinvest in property improvements.</li>
                <li><strong>Cap Rate</strong>: Calculated as Net Operating Income (NOI) divided by the property's value, this metric offers a snapshot of potential yield: \( \text{Cap Rate} = \frac{\text{NOI}}{\text{Property Value}} \). It helps compare investment opportunities independent of financing structures, with higher rates often found in emerging markets or higher-risk properties. Cap rate is particularly useful for valuing income-producing assets in commercial real estate contexts.</li>
                <li><strong>ROI</strong>: Measures the annual return on the initial investment, expressed as a percentage: \( \text{ROI} = \frac{\text{Annual Net Income}}{\text{Initial Investment}} \times 100 \). This includes cash flow and equity buildup over time, providing a comprehensive view of investment efficiency beyond simple profit calculations. ROI can be leveraged to benchmark against other asset classes like stocks or bonds.</li>
                <li><strong>IRR</strong>: The Internal Rate of Return accounts for the time value of money, solving for the discount rate that makes the net present value of all cash flows zero. It's particularly useful for evaluating investments with varying cash flows over multiple years, incorporating factors like inflation and opportunity costs. IRR aids in comparing complex projects with differing timelines and cash inflows.</li>
            </ul>

            <h3>Factors Impacting Returns</h3>
            <table>
                <thead>
                    <tr>
                        <th>Factor</th>
                        <th>Impact</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Appreciation</td>
                        <td>Drives long-term gains by increasing property value, influenced by economic growth, location improvements, and market demand, though it's subject to regional real estate cycles and broader economic conditions. In high-growth areas, appreciation can significantly amplify total returns over holding periods.</td>
                    </tr>
                    <tr>
                        <td>Management Fees</td>
                        <td>Typically 8-12% of rental income, these fees reduce net cash flow but delegate tasks like tenant screening and maintenance, ideal for hands-off investors seeking to minimize operational involvement. Professional management can enhance tenant retention and property value preservation.</td>
                    </tr>
                    <tr>
                        <td>Closing and Repair Costs</td>
                        <td>Upfront expenses that elevate the initial outlay, potentially delaying profitability but enhancing property appeal and rental rates post-renovation, especially in competitive markets. Strategic repairs can lead to higher occupancy and premium pricing.</td>
                    </tr>
                    <tr>
                        <td>Annual Increases</td>
                        <td>Inflation adjustments for expenses and rents ensure projections align with real-world economic shifts, preventing underestimation of future costs or income in dynamic financial environments. This factor is key for long-term planning in inflationary periods.</td>
                    </tr>
                    <tr>
                        <td>Vacancy Rates</td>
                        <td>Accounts for unoccupied periods, typically 5-10%, which directly affect income; lower rates in high-demand areas improve overall returns and stability of cash flows. Effective marketing and tenant relations can minimize vacancies.</td>
                    </tr>
                    <tr>
                        <td>Tax Implications</td>
                        <td>Deductions for depreciation, interest, and repairs can enhance after-tax returns, but changes in tax laws require ongoing monitoring to optimize investment strategies. Tax advantages like 1031 exchanges can defer capital gains for portfolio growth.</td>
                    </tr>
                    <tr>
                        <td>Location Dynamics</td>
                        <td>Properties in thriving neighborhoods with access to amenities, jobs, and transportation command higher rents and appreciation, but oversupply or economic downturns can erode value. Researching local market data is essential for risk mitigation.</td>
                    </tr>
                </tbody>
            </table>

            <h3>Investment Strategies Comparison</h3>
            <table>
                <thead>
                    <tr>
                        <th>Strategy</th>
                        <th>Pros</th>
                        <th>Cons</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Buy and Hold</td>
                        <td>Provides consistent rental income and benefits from property value growth over extended periods, building equity through mortgage paydown and tax advantages.</td>
                        <td>Involves ongoing management responsibilities and capital immobilization, with risks from market downturns affecting liquidity and income stability.</td>
                    </tr>
                    <tr>
                        <td>Fix and Flip</td>
                        <td>Offers rapid profits through targeted renovations and quick resales in rising markets, suitable for experienced investors with construction knowledge and market timing skills.</td>
                        <td>Carries risks from unforeseen repair costs and market downturns affecting sale prices, requiring precise timing and cost control to avoid losses.</td>
                    </tr>
                    <tr>
                        <td>REITs</td>
                        <td>Enables passive participation with diversified portfolios and liquidity, accessible to investors without direct property ownership through stock-like investments.</td>
                        <td>Limits direct control and may yield lower returns compared to hands-on ownership, with fees impacting net gains and market volatility affecting share prices.</td>
                    </tr>
                    <tr>
                        <td>Short-Term Rentals</td>
                        <td>Generates higher per-night income in popular locations like vacation spots, leveraging platforms for broader reach and flexible pricing.</td>
                        <td>Faces seasonal vacancies and stricter local regulations on platforms like Airbnb, increasing operational complexity and compliance costs.</td>
                    </tr>
                    <tr>
                        <td>Multi-Family Properties</td>
                        <td>Spreads risk across multiple units and scales income potential, often with better cash flow per square foot and economies of scale in management.</td>
                        <td>Requires more intensive management and higher upfront costs, with tenant turnover impacting stability and potential for concentrated risks in one location.</td>
                    </tr>
                </tbody>
            </table>

            <p>For comprehensive insights into real estate dynamics, explore resources from <a href="https://en.wikipedia.org/wiki/Real_estate_investing" target="_blank">Wikipedia on Real Estate Investing</a> or official data from <a href="https://www.hud.gov/topics/rental_assistance" target="_blank">U.S. Department of Housing and Urban Development</a>. Additional perspectives can be found on <a href="https://www.census.gov/library/publications/2023/demo/p60-281.html" target="_blank">U.S. Census Bureau reports on housing trends</a> and <a href="https://www.federalreserve.gov/publications/files/2023-report-economic-well-being-us-households-202405.pdf" target="_blank">Federal Reserve surveys on household finances</a>.</p>

            <h3>Disclaimer</h3>
            <p>This calculator provides estimates based on user inputs and does not constitute financial advice. Consult a professional advisor for personalized guidance. Actual results may vary due to market conditions, unexpected costs, or regulatory changes.</p>

            <h3>FAQ</h3>
            <ul>
                <li><strong>What is a good cap rate?</strong> Generally ranges from 5-10%, varying by property type and location; higher rates indicate better yields but may involve more risk in less stable areas.</li>
                <li><strong>How does appreciation affect ROI?</strong> It enhances total returns through increased equity upon sale, though conservative estimates are recommended to account for market uncertainties and economic fluctuations.</li>
                <li><strong>What vacancy rate should I use?</strong> A realistic range is 5-10%, depending on local demand; urban areas might see lower rates, while seasonal markets could experience higher variability.</li>
                <li><strong>Related tools:</strong> Explore our <a href="/mortgage-calculator.html">Mortgage Calculator</a> or <a href="/compound-interest-growth-calculator.html">Compound Interest Calculator</a>.</li>
            </ul>
        </section>

        <section class="related-resources">
            <h2>Related Resources</h2>
            <ul>
                <li><a href="https://www.investopedia.com/terms/r/realestate.asp" target="_blank">Investopedia on Real Estate</a></li>
                <li><a href="https://www.census.gov/topics/housing.html" target="_blank">U.S. Census Bureau Housing Data</a></li>
                <li><a href="https://ec.europa.eu/info/topics/single-market/services/services-goods/real-estate_en" target="_blank">EU Real Estate Information</a></li>
            </ul>
        </section>
    </main>

    <footer>
        Project created by Ivan Brkic. Project launched in 2020. Version 1.02
        <div class="footer-links">
            <a href="/sitemap.html">sitemap</a> <a href="/about.html">about us</a> <a href="/contact.html">contact us</a> <a href="/terms.html">terms of use</a> <a href="/privacy.html">privacy policy</a>
        </div>
    </footer>

    <script>
        let amortizationData = [];
        let expenseData = [];
        let cashFlowData = [];
        let valueData = [];
        let noiData = [];
        let roiComponentsData = [];

        let expenseChartInstance;
        let cashFlowChartInstance;
        let valueChartInstance;
        let noiChartInstance;
        let roiComponentsChartInstance;

        function calculateRental() {
            const currency = document.getElementById('currency').value;
            const price = parseFloat(document.getElementById('property-price').value);
            const closingCost = parseFloat(document.getElementById('closing-cost').value);
            const useLoan = document.getElementById('use-loan').value === 'yes';
            const downPct = useLoan ? parseFloat(document.getElementById('down-payment').value) / 100 : 1;
            const rate = useLoan ? parseFloat(document.getElementById('interest-rate').value) / 100 / 12 : 0;
            const term = useLoan ? parseInt(document.getElementById('loan-term').value) * 12 : 1;
            const needRepairs = document.getElementById('need-repairs').value === 'yes';
            const repairCost = needRepairs ? parseFloat(document.getElementById('repair-cost').value) : 0;
            const afterRepairValue = needRepairs ? parseFloat(document.getElementById('after-repair-value').value) : price;
            const taxes = parseFloat(document.getElementById('annual-taxes').value) / 12;
            const taxesIncrease = parseFloat(document.getElementById('taxes-increase').value) / 100;
            const insurance = parseFloat(document.getElementById('annual-insurance').value) / 12;
            const insuranceIncrease = parseFloat(document.getElementById('insurance-increase').value) / 100;
            const hoa = parseFloat(document.getElementById('hoa-fee').value);
            const hoaIncrease = parseFloat(document.getElementById('hoa-increase').value) / 100;
            const maintPct = parseFloat(document.getElementById('monthly-maintenance').value) / 100;
            const maintIncrease = parseFloat(document.getElementById('maintenance-increase').value) / 100;
            const otherCosts = parseFloat(document.getElementById('other-costs').value);
            const otherCostsIncrease = parseFloat(document.getElementById('other-costs-increase').value) / 100;
            const rent = parseFloat(document.getElementById('monthly-rent').value);
            const rentIncrease = parseFloat(document.getElementById('rent-increase').value) / 100;
            const otherIncome = parseFloat(document.getElementById('other-income').value);
            const otherIncomeIncrease = parseFloat(document.getElementById('other-income-increase').value) / 100;
            const vacancyPct = parseFloat(document.getElementById('vacancy-rate').value) / 100;
            const managementPct = parseFloat(document.getElementById('management-fee').value) / 100;
            const knowSellPrice = document.getElementById('know-sell-price').value === 'yes';
            const appreciation = parseFloat(document.getElementById('appreciation').value) / 100;
            const sellPrice = knowSellPrice ? parseFloat(document.getElementById('sell-price').value) : price * Math.pow(1 + appreciation, parseInt(document.getElementById('holding-length').value));
            const holdingLength = parseInt(document.getElementById('holding-length').value);
            const sellCostPct = parseFloat(document.getElementById('sell-cost').value) / 100;

            const downPayment = price * downPct;
            const loan = useLoan ? price - downPayment : 0;
            const monthlyMortgage = useLoan ? loan * (rate * Math.pow(1 + rate, term)) / (Math.pow(1 + rate, term) - 1) : 0;

            let totalCashFlow = 0;
            let yearlyExpenses = [];
            let yearlyIncome = [];
            let yearlyNOI = [];
            for (let year = 1; year <= holdingLength; year++) {
                const currentTaxes = taxes * Math.pow(1 + taxesIncrease, year - 1);
                const currentInsurance = insurance * Math.pow(1 + insuranceIncrease, year - 1);
                const currentHOA = hoa * Math.pow(1 + hoaIncrease, year - 1);
                const currentRent = rent * Math.pow(1 + rentIncrease, year - 1);
                const currentMaint = currentRent * maintPct * Math.pow(1 + maintIncrease, year - 1);
                const currentOtherCosts = otherCosts * Math.pow(1 + otherCostsIncrease, year - 1);
                const currentOtherIncome = otherIncome * Math.pow(1 + otherIncomeIncrease, year - 1);
                const currentManagement = currentRent * managementPct;

                const effectiveRent = (currentRent + currentOtherIncome) * (1 - vacancyPct);
                const monthlyExpenses = monthlyMortgage + currentTaxes + currentInsurance + currentHOA + currentMaint + currentOtherCosts + currentManagement;
                const cashFlow = effectiveRent - monthlyExpenses;

                yearlyExpenses.push(monthlyExpenses * 12);
                yearlyIncome.push(effectiveRent * 12);
                yearlyNOI.push((effectiveRent - (currentTaxes + currentInsurance + currentHOA + currentMaint + currentOtherCosts + currentManagement)) * 12);
                totalCashFlow += cashFlow * 12;
            }

            const initialInvestment = downPayment + closingCost + repairCost;
            const noi = yearlyNOI[0];
            const capRate = (noi / (needRepairs ? afterRepairValue : price)) * 100;
            const roi = (totalCashFlow / holdingLength / initialInvestment) * 100;
            const sellCost = sellPrice * sellCostPct;
            const totalReturn = totalCashFlow + (sellPrice - sellCost - loan);

            // Simple IRR approximation
            let irr = 0;
            let npv = 0;
            for (let i = -1; i < holdingLength; i++) {
                const cashFlow = i === -1 ? -initialInvestment : (i === holdingLength - 1 ? yearlyNOI[i] + (sellPrice - sellCost - loan) : yearlyNOI[i]);
                npv += cashFlow / Math.pow(1 + irr, i + 1);
            }
            for (let r = 0; r < 0.5; r += 0.001) {
                let testNpv = 0;
                for (let i = -1; i < holdingLength; i++) {
                    const cashFlow = i === -1 ? -initialInvestment : (i === holdingLength - 1 ? yearlyNOI[i] + (sellPrice - sellCost - loan) : yearlyNOI[i]);
                    testNpv += cashFlow / Math.pow(1 + r, i + 1);
                }
                if (Math.abs(testNpv) < Math.abs(npv)) {
                    npv = testNpv;
                    irr = r;
                }
            }

            document.getElementById('monthly-mortgage').textContent = `Monthly Mortgage: ${currency}${monthlyMortgage.toFixed(2)}`;
            document.getElementById('monthly-cash-flow').textContent = `Monthly Cash Flow: ${currency}${(yearlyIncome[0] / 12 - yearlyExpenses[0] / 12).toFixed(2)}`;
            document.getElementById('cap-rate').textContent = `Cap Rate: ${capRate.toFixed(2)}%`;
            document.getElementById('annual-roi').textContent = `Annual ROI: ${roi.toFixed(2)}%`;
            document.getElementById('irr').textContent = `Internal Rate of Return (IRR): ${(irr * 100).toFixed(2)}%`;
            document.getElementById('total-return').textContent = `Total Return Over Term: ${currency}${totalReturn.toFixed(2)}`;

            document.getElementById('results').style.display = 'block';
            document.getElementById('pdf-button').style.display = 'block';

            // Amortization
            amortizationData = [];
            let balance = loan;
            let totalPrincipal = 0;
            let totalInterest = 0;
            const tableBody = document.querySelector('#amortization-table tbody');
            tableBody.innerHTML = '';
            document.getElementById('amortization-table').style.display = 'table';

            for (let year = 1; year <= (useLoan ? document.getElementById('loan-term').value : 1); year++) {
                let yearlyPrincipal = 0;
                let yearlyInterest = 0;
                for (let month = 1; month <= 12 && balance > 0; month++) {
                    const interest = balance * rate;
                    const principal = monthlyMortgage - interest;
                    balance -= principal;
                    yearlyPrincipal += principal;
                    yearlyInterest += interest;
                }
                totalPrincipal += yearlyPrincipal;
                totalInterest += yearlyInterest;
                amortizationData.push([year, currency + yearlyPrincipal.toFixed(2), currency + yearlyInterest.toFixed(2), currency + balance.toFixed(2)]);
                const row = document.createElement('tr');
                row.innerHTML = `<td>${year}</td><td>${currency}${yearlyPrincipal.toFixed(2)}</td><td>${currency}${yearlyInterest.toFixed(2)}</td><td>${currency}${balance.toFixed(2)}</td>`;
                tableBody.appendChild(row);
            }

            // Destroy existing charts
            if (expenseChartInstance) expenseChartInstance.destroy();
            if (cashFlowChartInstance) cashFlowChartInstance.destroy();
            if (valueChartInstance) valueChartInstance.destroy();
            if (noiChartInstance) noiChartInstance.destroy();
            if (roiComponentsChartInstance) roiComponentsChartInstance.destroy();

            // Charts
            expenseData = [monthlyMortgage, taxes, insurance, hoa, rent * maintPct, otherCosts, rent * managementPct, rent * vacancyPct];
            const expenseCtx = document.getElementById('expenseChart').getContext('2d');
            expenseChartInstance = new Chart(expenseCtx, {
                type: 'pie',
                data: {
                    labels: ['Mortgage', 'Taxes', 'Insurance', 'HOA', 'Maintenance', 'Other Costs', 'Management', 'Vacancy Loss'],
                    datasets: [{ data: expenseData, backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#C9CBCF', '#36A2EB'] }]
                },
                options: { responsive: true, plugins: { title: { display: true, text: 'First Year Expense Breakdown' } } }
            });

            cashFlowData = [];
            for (let i = 0; i < holdingLength; i++) {
                cashFlowData.push(yearlyIncome[i] - yearlyExpenses[i]);
            }
            const cashFlowCtx = document.getElementById('cashFlowChart').getContext('2d');
            cashFlowChartInstance = new Chart(cashFlowCtx, {
                type: 'line',
                data: {
                    labels: Array.from({length: holdingLength}, (_, i) => `Year ${i+1}`),
                    datasets: [{ label: 'Annual Cash Flow', data: cashFlowData, borderColor: '#36A2EB' }]
                },
                options: { responsive: true, plugins: { title: { display: true, text: 'Cash Flow Over Time' } } }
            });

            valueData = [];
            for (let i = 0; i < holdingLength; i++) {
                valueData.push((needRepairs ? afterRepairValue : price) * Math.pow(1 + appreciation, i));
            }
            const valueCtx = document.getElementById('valueChart').getContext('2d');
            valueChartInstance = new Chart(valueCtx, {
                type: 'line',
                data: {
                    labels: Array.from({length: holdingLength}, (_, i) => `Year ${i+1}`),
                    datasets: [{ label: 'Property Value', data: valueData, borderColor: '#FF6384' }]
                },
                options: { responsive: true, plugins: { title: { display: true, text: 'Property Value Over Time' } } }
            });

            // New Chart: NOI Bar Chart
            noiData = yearlyNOI;
            const noiCtx = document.getElementById('noiChart').getContext('2d');
            noiChartInstance = new Chart(noiCtx, {
                type: 'bar',
                data: {
                    labels: Array.from({length: holdingLength}, (_, i) => `Year ${i+1}`),
                    datasets: [{ label: 'Net Operating Income', data: noiData, backgroundColor: '#4BC0C0' }]
                },
                options: { responsive: true, plugins: { title: { display: true, text: 'Net Operating Income Over Years' } } }
            });

            // New Chart: ROI Components Doughnut
            roiComponentsData = [totalCashFlow, (sellPrice - sellCost - loan), -initialInvestment];
            const roiComponentsCtx = document.getElementById('roiComponentsChart').getContext('2d');
            roiComponentsChartInstance = new Chart(roiComponentsCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Total Cash Flow', 'Sale Profit', 'Initial Investment'],
                    datasets: [{ data: roiComponentsData.map(Math.abs), backgroundColor: ['#36A2EB', '#FFCE56', '#FF6384'] }]
                },
                options: { responsive: true, plugins: { title: { display: true, text: 'ROI Components Breakdown' } } }
            });
        }

        function saveAsPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const currency = document.getElementById('currency').value;

            doc.setFont("helvetica");
            doc.setFontSize(14);
            doc.text("Rental Property ROI Calculator Results", 105, 15, { align: "center" });

            // Results Table
            doc.autoTable({
                startY: 20,
                head: [['Parameter', 'Value']],
                body: [
                    ['Monthly Mortgage', document.getElementById('monthly-mortgage').textContent.split(': ')[1]],
                    ['Monthly Cash Flow', document.getElementById('monthly-cash-flow').textContent.split(': ')[1]],
                    ['Cap Rate', document.getElementById('cap-rate').textContent.split(': ')[1]],
                    ['Annual ROI', document.getElementById('annual-roi').textContent.split(': ')[1]],
                    ['Internal Rate of Return (IRR)', document.getElementById('irr').textContent.split(': ')[1]],
                    ['Total Return Over Term', document.getElementById('total-return').textContent.split(': ')[1]]
                ],
                theme: 'grid',
                headStyles: { fillColor: [0, 200, 200], textColor: [255, 255, 255] },
                alternateRowStyles: { fillColor: [255, 255, 255] },
                styles: { lineColor: [200, 200, 200], lineWidth: 0.1, cellPadding: 3, font: "helvetica", halign: 'left' },
                margin: { top: 10 }
            });

            // Amortization Table
            doc.autoTable({
                startY: doc.lastAutoTable.finalY + 10,
                head: [['Year', 'Principal Paid', 'Interest Paid', 'Balance']],
                body: amortizationData,
                theme: 'grid',
                headStyles: { fillColor: [0, 200, 200], textColor: [255, 255, 255] },
                alternateRowStyles: { fillColor: [245, 245, 245] },
                styles: { lineColor: [200, 200, 200], lineWidth: 0.1, cellPadding: 3, font: "helvetica", halign: 'left' },
                didDrawPage: function (data) {
                    doc.setFontSize(10);
                    doc.setTextColor(100);
                    doc.text('This document was generated using Fcalculator.com', doc.internal.pageSize.width / 2, doc.internal.pageSize.height - 10, { align: 'center' });
                }
            });

            doc.save('rental-property-roi-results.pdf');
        }

        function sharePage() {
            if (navigator.share) {
                navigator.share({
                    title: 'Rental Property ROI Calculator',
                    url: window.location.href
                });
            } else {
                alert('Share this page manually.');
            }
        }

        // Auto-calculate on page load
        window.onload = function() {
            calculateRental();
        };
    </script>
</body>
</html>
