const countries = {
    world: {baseYear: 2025, basePop: 8230000000, growth: 0.0085, peakYear: 2084, peakPop: 10300000000, declineRate: -0.001, area: 510072000},
    india: {baseYear: 2025, basePop: 1463865525, growth: 0.009, peakYear: 2060, peakPop: 1650000000, declineRate: -0.002, area: 3287263},
    china: {baseYear: 2025, basePop: 1416096094, growth: -0.001, peakYear: 2023, peakPop: 1417000000, declineRate: -0.005, area: 9596961},
    usa: {baseYear: 2025, basePop: 347275807, growth: 0.005, peakYear: 2100, peakPop: 381000000, declineRate: 0, area: 9833517},
    // Dodaj ostale sa area (km²) za density = pop / area
    // Primjer: bangladesh: {..., area: 147570}, russia: {..., area: 17098242}, itd. - potpuni list u kodu.
};

const historicalData = {
    years: [1925, 1930, 1935, 1940, 1945, 1950, 1955, 1960, 1965, 1970, 1975, 1980, 1985, 1990, 1995, 2000, 2005, 2010, 2015, 2020, 2025],
    pop: [2000000000, 2100000000, 2200000000, 2300000000, 2400000000, 2525000000, 2750000000, 3000000000, 3300000000, 3700000000, 4000000000, 4400000000, 4800000000, 5300000000, 5700000000, 6100000000, 6500000000, 6900000000, 7400000000, 7800000000, 8230000000]
};

const projectionData = {
    years: [2025, 2030, 2035, 2040, 2045, 2050, 2055, 2060, 2065, 2070, 2075, 2080, 2085, 2090, 2095, 2100, 2105, 2110, 2115, 2120, 2125],
    pop: [8230000000, 8500000000, 8800000000, 9100000000, 9400000000, 9660000000, 9900000000, 10100000000, 10300000000, 10400000000, 10500000000, 10600000000, 10300000000, 10250000000, 10200000000, 10150000000, 10100000000, 10050000000, 10000000000, 9950000000, 9900000000]
};

// Density data for top countries (area in km²)
const densityData = {
    india: {area: 3287263},
    china: {area: 9596961},
    usa: {area: 9833517},
    indonesia: {area: 1913579},
    pakistan: {area: 881913},
    nigeria: {area: 923768},
    brazil: {area: 8515767},
    bangladesh: {area: 147570},
    russia: {area: 17098242},
    ethiopia: {area: 1104300},
    // Dodaj ostale
};

function calculatePopulation() {
    var year = parseInt(document.getElementById('year').value);
    var country = document.getElementById('country').value;
    if (isNaN(year) || year < 1925 || year > 2125) {
        document.getElementById('population-result').innerText = 'Please enter a year between 1925 and 2125.';
        return;
    }
    var data = countries[country] || countries.world;
    var baseYear = data.baseYear;
    var basePop = data.basePop;
    var growth = data.growth;
    var peakYear = data.peakYear;
    var peakPop = data.peakPop;
    var declineRate = data.declineRate;
    var t = year - baseYear;
    var pop = year <= peakYear ? basePop * Math.exp(growth * t) : peakPop * Math.exp(declineRate * (year - peakYear));
    pop = Math.max(0, Math.round(pop));
    var foodNeeds = (pop / 1000000000) * 1.1; // Example scaling
    var waterNeeds = (pop / 1000000000) * 3.7;
    var energyNeeds = (pop / 1000000000) * 1.5;
    document.getElementById('population-result').innerText = 'Estimated Population: ' + pop.toLocaleString() + '\nGrowth Rate: ' + (growth * 100).toFixed(2) + '% (adjusted for ' + country + ')\nFuture Needs: Food demand +110% (' + foodNeeds.toFixed(1) + 'B units), Water shortages for ' + waterNeeds.toFixed(1) + 'B people, Energy +50% (' + energyNeeds.toFixed(1) + 'B units)';
    drawHistoricalLineChart();
    drawProjectionLineChart();
    drawPieChart(country, pop);
    drawBarChart(growth);
    drawNeedsBar(foodNeeds, waterNeeds, energyNeeds);
    drawDensityScatter(country, pop);
}

function drawHistoricalLineChart() {
    var canvas = document.getElementById('historical-line-chart');
    var ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    // Grid
    ctx.strokeStyle = '#ccc';
    for (var i = 1; i < 5; i++) {
        ctx.beginPath();
        ctx.moveTo(0, i * (canvas.height / 5));
        ctx.lineTo(canvas.width, i * (canvas.height / 5));
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(i * (canvas.width / 5), 0);
        ctx.lineTo(i * (canvas.width / 5), canvas.height);
        ctx.stroke();
    }
    // Line
    ctx.beginPath();
    var maxPop = 9000000000;
    historicalData.years.forEach((y, i) => {
        var x = i * (canvas.width / (historicalData.years.length - 1));
        var yPos = canvas.height - (historicalData.pop[i] / maxPop * canvas.height);
        if (i === 0) ctx.moveTo(x, yPos);
        else ctx.lineTo(x, yPos);
        ctx.fillStyle = '#000';
        if (i % 5 === 0) ctx.fillText(y, x - 20, canvas.height - 10);
        ctx.fillText((historicalData.pop[i] / 1000000000).toFixed(1) + 'B', x - 20, yPos - 10);
    });
    ctx.strokeStyle = '#36A2EB';
    ctx.stroke();
    // Legend
    ctx.fillStyle = '#36A2EB';
    ctx.fillRect(10, 10, 20, 10);
    ctx.fillStyle = '#000';
    ctx.fillText('Historical Population', 40, 20);
}

function drawProjectionLineChart() {
    var canvas = document.getElementById('projection-line-chart');
    var ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    // Grid
    ctx.strokeStyle = '#ccc';
    for (var i = 1; i < 5; i++) {
        ctx.beginPath();
        ctx.moveTo(0, i * (canvas.height / 5));
        ctx.lineTo(canvas.width, i * (canvas.height / 5));
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(i * (canvas.width / 5), 0);
        ctx.lineTo(i * (canvas.width / 5), canvas.height);
        ctx.stroke();
    }
    // Line
    ctx.beginPath();
    var maxPop = 12000000000;
    projectionData.years.forEach((y, i) => {
        var x = i * (canvas.width / (projectionData.years.length - 1));
        var yPos = canvas.height - (projectionData.pop[i] / maxPop * canvas.height);
        if (i === 0) ctx.moveTo(x, yPos);
        else ctx.lineTo(x, yPos);
        ctx.fillStyle = '#000';
        if (i % 5 === 0) ctx.fillText(y, x - 20, canvas.height - 10);
        ctx.fillText((projectionData.pop[i] / 1000000000).toFixed(1) + 'B', x - 20, yPos - 10);
        if (y === 2084) {
            ctx.fillStyle = '#FF0000';
            ctx.beginPath();
            ctx.arc(x, yPos, 5, 0, 2 * Math.PI);
            ctx.fill();
            ctx.fillStyle = '#000';
            ctx.fillText('Peak', x + 10, yPos - 10);
        }
    });
    ctx.strokeStyle = '#FF6384';
    ctx.stroke();
    // Legend
    ctx.fillStyle = '#FF6384';
    ctx.fillRect(10, 10, 20, 10);
    ctx.fillStyle = '#000';
    ctx.fillText('Projected Population', 40, 20);
}

function drawPieChart(country, pop) {
    var canvas = document.getElementById('population-pie-chart');
    var ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    var worldPop = countries.world.basePop * Math.exp(countries.world.growth * (parseInt(document.getElementById('year').value) - 2025));
    var topShares = [18, 17, 4, 3.5, 3.1]; // Top 5 % (adjusted dynamically if possible)
    var colors = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'];
    var labels = ['India', 'China', 'USA', 'Indonesia', 'Pakistan'];
    var startAngle = 0;
    topShares.forEach((share, i) => {
        var angle = (share / 100) * 2 * Math.PI;
        ctx.beginPath();
        ctx.moveTo(100, 100);
        ctx.arc(100, 100, 90, startAngle, startAngle + angle);
        ctx.fillStyle = colors[i];
        ctx.fill();
        ctx.fillStyle = '#000';
        ctx.fillText(labels[i] + ' ' + share + '%', 120, 30 + i * 20);
        startAngle += angle;
    });
    ctx.fillStyle = '#000';
    ctx.font = '12px Arial';
    ctx.fillText('Top 5 Countries Share', 50, 180);
    // Highlight selected
    if (country !== 'world') {
        ctx.fillStyle = '#000';
        ctx.fillText(country + ': ~' + (pop / worldPop * 100).toFixed(2) + '%', 50, 200);
    }
}

function drawBarChart(growth) {
    var canvas = document.getElementById('growth-bar-chart');
    var ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    // Grid
    ctx.strokeStyle = '#ccc';
    for (var i = 1; i < 5; i++) {
        ctx.beginPath();
        ctx.moveTo(0, i * (canvas.height / 5));
        ctx.lineTo(canvas.width, i * (canvas.height / 5));
        ctx.stroke();
    }
    var bars = [0.021, 0.012, growth, 0.001, -0.001]; // Past high, past low, current, future low, decline
    var labels = ['Past High (1960s)', 'Past Avg', 'Current', 'Future Low', 'Decline'];
    bars.forEach((val, i) => {
        var height = Math.abs(val * 5000); // Scale
        ctx.fillStyle = val > 0 ? '#4CAF50' : '#FF6384';
        ctx.fillRect(i * 80 + 20, canvas.height - height, 60, height);
        ctx.fillStyle = '#000';
        ctx.fillText((val * 100).toFixed(2) + '%', i * 80 + 25, canvas.height - height - 5);
        ctx.fillText(labels[i], i * 80 + 5, canvas.height - 10, 70);
    });
    ctx.fillText('Growth Rates', 150, 20);
}

function drawNeedsBar(foodNeeds, waterNeeds, energyNeeds) {
    var canvas = document.getElementById('needs-bar-chart');
    var ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    // Grid
    ctx.strokeStyle = '#ccc';
    for (var i = 1; i < 5; i++) {
        ctx.beginPath();
        ctx.moveTo(0, i * (canvas.height / 5));
        ctx.lineTo(canvas.width, i * (canvas.height / 5));
        ctx.stroke();
    }
    var bars = [foodNeeds, waterNeeds, energyNeeds];
    var labels = ['Food (+110%)', 'Water (B ppl)', 'Energy (+50%)'];
    var units = ['B units', 'B people', 'B units'];
    bars.forEach((val, i) => {
        var height = val * 20; // Scale
        ctx.fillStyle = ['#FFCE56', '#36A2EB', '#FF6384'][i];
        ctx.fillRect(i * 100 + 20, canvas.height - height, 60, height);
        ctx.fillStyle = '#000';
        ctx.fillText(val.toFixed(1) + ' ' + units[i], i * 100 + 5, canvas.height - height - 5);
        ctx.fillText(labels[i], i * 100 + 5, canvas.height - 10);
    });
    ctx.fillText('Future Needs', 150, 20);
}

function drawDensityScatter(country, pop) {
    var canvas = document.getElementById('density-scatter-chart');
    var ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    // Grid
    ctx.strokeStyle = '#ccc';
    for (var i = 1; i < 5; i++) {
        ctx.beginPath();
        ctx.moveTo(0, i * (canvas.height / 5));
        ctx.lineTo(canvas.width, i * (canvas.height / 5));
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(i * (canvas.width / 5), 0);
        ctx.lineTo(i * (canvas.width / 5), canvas.height);
        ctx.stroke();
    }
    // Sample top 10 density data
    var densitySamples = [
        {name: 'Bangladesh', pop: 171500000, density: 1265},
        {name: 'India', pop: 1463865525, density: 464},
        {name: 'Japan', pop: 123000000, density: 333},
        {name: 'Philippines', pop: 118000000, density: 314},
        {name: 'Vietnam', pop: 100000000, density: 308},
        {name: 'Pakistan', pop: 255219554, density: 287},
        {name: 'Nigeria', pop: 227900000, density: 250},
        {name: 'Germany', pop: 83000000, density: 238},
        {name: 'China', pop: 1416096094, density: 151},
        {name: 'USA', pop: 347275807, density: 36}
    ];
    var maxPop = 1500000000;
    var maxDensity = 1300;
    densitySamples.forEach((d, i) => {
        var x = (d.pop / maxPop) * canvas.width;
        var y = canvas.height - (d.density / maxDensity * canvas.height);
        ctx.fillStyle = '#4CAF50';
        ctx.beginPath();
        ctx.arc(x, y, 5, 0, 2 * Math.PI);
        ctx.fill();
        ctx.fillStyle = '#000';
        ctx.fillText(d.name, x + 10, y);
        if (d.name.toLowerCase() === country) {
            ctx.fillStyle = '#FF0000';
            ctx.beginPath();
            ctx.arc(x, y, 8, 0, 2 * Math.PI);
            ctx.stroke();
        }
    });
    ctx.fillText('Pop (B) ->', canvas.width - 50, canvas.height - 10);
    ctx.fillText('Density (p/km²) ^', 10, 20);
}

function sharePage() {
    if (navigator.share) {
        navigator.share({
            title: 'World Population Calculator - FCalculator.com',
            url: window.location.href
        });
    } else {
        alert('Share this page: ' + window.location.href);
    }
}
    </script>
</body>
</html>
